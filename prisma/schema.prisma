generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Empresa {
  id         Bytes    @id @db.Binary(16)
  nombre     String   @db.VarChar(150)
  nit        String?  @unique @db.VarChar(50)
  direccion  String?  @db.VarChar(255)
  telefono   String?  @db.VarChar(25)
  email      String?  @db.VarChar(150)
  created_at DateTime
  updated_at DateTime

  usuarios Usuario[]
  roles    Rol[]

  @@map("empresas")
}

model Permiso {
  id          Bytes    @id @db.Binary(16)
  codigo      String   @unique @db.VarChar(100)
  descripcion String   @db.VarChar(255)
  es_sistema  Int?     @default(1) @db.TinyInt
  created_at  DateTime?

  roles RolPermiso[]

  @@map("permisos")
}

model Rol {
  id          Bytes    @id @db.Binary(16)
  empresa_id  Bytes    @db.Binary(16)
  nombre      String   @db.VarChar(100)
  descripcion String?  @db.VarChar(255)
  es_sistema  Int?     @default(0) @db.TinyInt
  created_at  DateTime?

  empresa Empresa @relation(fields: [empresa_id], references: [id], onDelete: Cascade)
  usuarios UsuarioRol[]
  permisos RolPermiso[]

  @@unique([empresa_id, nombre])
  @@map("roles")
}

model Usuario {
  id            Bytes    @id @db.Binary(16)
  empresa_id    Bytes    @db.Binary(16)
  nombre        String   @db.VarChar(150)
  email         String   @db.VarChar(150)
  password_hash String   @db.VarChar(255)
  activo        Int?     @default(1) @db.TinyInt
  telefono      String?  @db.VarChar(25)
  created_at    DateTime?
  updated_at    DateTime?

  empresa Empresa @relation(fields: [empresa_id], references: [id], onDelete: Cascade)
  roles   UsuarioRol[]

  @@unique([empresa_id, email])
  @@map("usuarios")
}

model UsuarioRol {
  usuario_id Bytes @db.Binary(16)
  rol_id     Bytes @db.Binary(16)

  usuario Usuario @relation(fields: [usuario_id], references: [id], onDelete: Cascade)
  rol     Rol     @relation(fields: [rol_id], references: [id], onDelete: Cascade)

  @@id([usuario_id, rol_id])
  @@map("usuario_rol")
}

model RolPermiso {
  id          Bytes @id @db.Binary(16)
  rol_id      Bytes @db.Binary(16)
  permiso_id  Bytes @db.Binary(16)

  rol     Rol     @relation(fields: [rol_id], references: [id], onDelete: Cascade)
  permiso Permiso @relation(fields: [permiso_id], references: [id], onDelete: Cascade)

  @@unique([rol_id, permiso_id])
  @@map("rol_permiso")
}
